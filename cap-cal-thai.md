# C-CAX MVP: ระเบียบวิธีการคำนวณ "Cap"

## 1. วัตถุประสงค์

เป้าหมายของแบบจำลองนี้ คือการคำนวณ **"เพดานการปล่อยมลพิษรายวัน" (Daily Emission Cap หรือ "Cap")** สำหรับพื้นที่แอ่งเชียงใหม่-ลำพูน "Cap" นี้หมายถึงปริมาณ PM2.5 สูงสุด (ในหน่วย **ตัน/วัน**) ที่สามารถปล่อยสู่ชั้นบรรยากาศได้ โดยที่ยังคงรักษาคุณภาพอากาศโดยเฉลี่ยให้ไม่เกินมาตรฐานของประเทศไทย (37.5 µg/m³)

## 2. แบบจำลองทางวิทยาศาสตร์: Steady-State Box Model

ระเบียบวิธีของเราอิงตามแนวทางทางวิทยาศาสตร์ที่เป็นมาตรฐานและสามารถอธิบายได้ ซึ่งเรียกว่า **"แบบจำลองกล่องคงที่" (Steady-State Box Model)**

แบบจำลองนี้จะจำลองพื้นที่แอ่งเชียงใหม่-ลำพูน เสมือนเป็น "กล่อง" ง่ายๆ เราจะคำนวณปริมาณมลพิษสูงสุดที่สามารถ "เติม" ลงในกล่องนี้ได้ โดยอิงจากความเร็วที่ลม "ระบาย" มลพิษนั้น "ออก" ไปจากกล่อง

สมมติฐานหลักคือ: **ปริมาณมลพิษที่เติมเข้า = ปริมาณมลพิษที่ระบายออก**

## 3. สูตรการคำนวณหลัก

แบบจำลองนี้จะคำนวณหาค่า **Q** ("Cap") โดยใช้สูตรต่อไปนี้:

$$Q = \frac{C \cdot V}{\tau}$$

โดยที่:

- **Q = "เพดาน" อัตราการปล่อย** (มวล/เวลา)
  - _นี่คือคำตอบที่เราต้องการ (เช่น ตัน/วัน)_
- **C = ค่าความเข้มข้นเป้าหมาย** (มวล/ปริมาตร)
  - _เป้าหมายคุณภาพอากาศที่เรากำหนด_
- **V = ปริมาตรของกล่อง** (ปริมาตร)
  - _"ขนาด" ของอากาศในแอ่ง ซึ่งเปลี่ยนแปลงทุกวัน_
- **$\tau$ (Tau) = เวลาคงอยู่** (เวลา)
  - _เวลาเฉลี่ยที่อากาศใช้ในการระบายออกจากกล่อง_

---

## 4. ขั้นตอนการคำนวณ (Step-by-Step)

นี่คือวิธีที่สคริปต์ (`cap_calculator.py`) จะใช้ในการคำนวณ Cap ในแต่ละวัน

### ขั้นตอนที่ 1: กำหนดค่าคงที่ (Static Constants)

นี่คือตัวเลขคงที่ ที่กำหนด "รูปทรง" ของกล่องและเป้าหมายของเรา

- **C (ค่าความเข้มข้นเป้าหมาย):**
  - **ค่า:** `37.5` µg/m³ (ไมโครกรัมต่อลูกบาศก์เมตร)
  - _เหตุผล:_ ค่ามาตรฐานคุณภาพอากาศ 24 ชั่วโมงของไทยสำหรับ PM2.5
- **A (พื้นที่แอ่ง):**
  - **ค่า:** `1,600,000,000` m² (1,600 กม.²)
  - _เหตุผล:_ ค่าประมาณการ "พื้น" ของแอ่งจากข้อมูล GIS
- **L (ความยาวแอ่ง):**
  - **ค่า:** `80,000` m (80 กม.)
  - _เหตุผล:_ ความยาว (เหนือ-ใต้) โดยประมาณ เพื่อใช้คำนวณเวลาในการระบายอากาศ
- **K (ตัวคูณแปลงหน่วย):**
  - **ค่า:** `8.64e-8`
  - _เหตุผล:_ ค่าคงที่สำหรับแปลงหน่วย `µg/s` (ไมโครกรัม/วินาที) ไปเป็น `Tons/Day` (ตัน/วัน)

### ขั้นตอนที่ 2: ดึงตัวแปรผัน (Dynamic Variables) (ผ่าน API)

ข้อมูลนี้เปลี่ยนแปลงทุกวัน สคริปต์จะเรียก **Open-Meteo API** เพื่อดึงข้อมูลพยากรณ์ 24 ชั่วโมง

- **H (เพดานการระบายอากาศ):**
  - **แหล่งข้อมูล:** พารามิเตอร์ `blh` (Boundary Layer Height) จาก API (หน่วยเป็นเมตร)
  - **ตรรกะ:** เราดึงข้อมูลรายชั่วโมง 24 ค่าสำหรับวันพรุ่งนี้ และนำมาคำนวณ **ค่าเฉลี่ย 24 ชั่วโมง**
- **U (ความเร็วลม):**
  - **แหล่งข้อมูล:** พารามิเตอร์ `wind_speed_10m` จาก API (หน่วยเป็น km/h)
  - **ตรรกะ:** เราดึงข้อมูลรายชั่วโมง 24 ค่า แปลงเป็น `m/s` และนำมาคำนวณ **ค่าเฉลี่ย 24 ชั่วโมง**

### ขั้นตอนที่ 3: คำนวณตัวแปรกลาง

สคริปต์จะใช้ข้อมูลจากขั้นตอนที่ 1 และ 2 เพื่อหาค่า **V** และ **$\tau$**

- **การคำนวณ V (ปริมาตร):**
  - **สูตร:** `V = A * H`
  - **ตัวอย่าง:** `1,600,000,000 m² * 332.3 m (ค่า H เฉลี่ย)` = `5.3e11 m³`
- **การคำนวณ $\tau$ (เวลาคงอยู่):**
  - **สูตร:** `$\tau$ = L / U`
  - **ตัวอย่าง:** `80,000 m / 0.8 m/s (ค่า U เฉลี่ย)` = `100,000 วินาที` (~27.8 ชั่วโมง)

### ขั้นตอนที่ 4: คำนวณหา Q (The Cap)

ตอนนี้สคริปต์มีตัวเลขครบทุกตัวเพื่อแก้สูตรหลัก

1.  **คำนวณ Q ในหน่วย µg/s:**

    - **สูตร:** `Q = (C * V) / $\tau$`
    - **ตัวอย่าง:** `(37.5 * 5.3e11) / 100,000` = `187,500,000 µg/s`

2.  **แปลงเป็น ตัน/วัน:**
    - **สูตร:** `Cap = Q (ในหน่วย µg/s) * K`
    - **ตัวอย่าง:** `187,500,000 * 8.64e-8` = **`16.15 ตัน/วัน`**

ตัวเลขสุดท้ายนี้คือ "เพดานการปล่อยมลพิษรายวัน"

---

## 5. ข้อสมมติฐานสำคัญและจุดอ่อนของระเบียบวิธี

MVP นี้มีประสิทธิภาพ แต่ก็อาศัยการลดความซับซ้อนลง จุดอ่อนที่สำคัญที่สุดของระเบียบวิธีนี้ คือ:

1.  **Plug Flow ($\tau$):** เราสมมติว่าอากาศเคลื่อนที่เหมือน "ก้อน" ของแข็งในทิศทางเดียว แต่ในความเป็นจริง อากาศมีการหมุนวนและมี "จุดอับ" นี่คือการลดความซับซ้อนทางวิทยาศาสตร์ที่ใหญ่ที่สุด
2.  **รูปทรงกล่อง ($V$):** เราสมมติว่าแอ่งเป็น "กล่อง" สี่เหลี่ยมก้นแบน แต่ในความเป็นจริง แอ่งมีลักษณะเป็นรูปตัว V ซึ่งหมายความว่าเราอาจ "ประเมินปริมาตร ($V$) สูงเกินไป" โดยเฉพาะในวันที่เพดานอากาศต่ำ
3.  **การใช้ค่าเฉลี่ย 24 ชั่วโมง ($H$, $U$):** เราใช้ค่าเฉลี่ยของสภาพอากาศทั้งวัน ซึ่งเป็นการ "ซ่อน" ช่วงเวลาวิกฤต (เช่น สภาวะ Inversion ในตอนเช้า) ที่ "Cap" ที่แท้จริงเกือบเป็นศูนย์ แต่กิจกรรมการจราจรและการเผาเกิดขึ้นสูง

แม้จะมีจุดอ่อนเหล่านี้ แบบจำลองนี้ก็ยังเป็น MVP ที่แข็งแกร่งและมีพื้นฐานทางวิทยาศาสตร์ ซึ่งเชื่อมโยงขีดความสามารถในการรองรับของชั้นบรรยากาศเข้ากับ "Cap" เชิงปริมาณรายวันได้สำเร็จ
